# Apache Configuration for Secure File Hosting Server
# Place this file in /etc/apache2/sites-available/secure-file-hosting.conf
# Enable site: sudo a2ensite secure-file-hosting.conf

<VirtualHost *:80>
    ServerName your-domain.com
    ServerAlias www.your-domain.com
    ServerAdmin admin@your-domain.com

    # Document root
    DocumentRoot /var/www/secure-file-hosting

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/secure-file-hosting-error.log
    CustomLog ${APACHE_LOG_DIR}/secure-file-hosting-access.log combined

    # WSGI Configuration for Flask
    WSGIDaemonProcess securefilehosting python-path=/var/www/secure-file-hosting:/var/www/secure-file-hosting/venv/lib/python3.10/site-packages
    WSGIProcessGroup securefilehosting
    WSGIScriptAlias / /var/www/secure-file-hosting/wsgi.py

    <Directory /var/www/secure-file-hosting>
        Require all granted
        Options -Indexes +FollowSymLinks
        AllowOverride None
    </Directory>

    # Static files
    Alias /static /var/www/secure-file-hosting/static
    <Directory /var/www/secure-file-hosting/static>
        Require all granted
        Options -Indexes
    </Directory>

    # Security headers
    Header always set X-Frame-Options "DENY"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Maximum upload size (100MB)
    LimitRequestBody 104857600

    # Deny access to sensitive files
    <DirectoryMatch "^/.*/\.git/">
        Require all denied
    </DirectoryMatch>

    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>

    # Redirect HTTP to HTTPS (uncomment when SSL is configured)
    # RewriteEngine On
    # RewriteCond %{HTTPS} off
    # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

# HTTPS Configuration (uncomment when SSL certificate is obtained)
# <VirtualHost *:443>
#     ServerName your-domain.com
#     ServerAlias www.your-domain.com
#     ServerAdmin admin@your-domain.com
#
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/your-domain.com/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/your-domain.com/privkey.pem
#
#     # SSL Security
#     SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite HIGH:!aNULL:!MD5
#     SSLHonorCipherOrder on
#
#     # HSTS Header
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#
#     # Same configuration as HTTP (copy from above)
#     # ...
# </VirtualHost>
